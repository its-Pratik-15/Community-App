generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Role {
  TENANT
  OWNER
  SECRETARY
  STAFF
}

model User {
  id            Int          @id @default(autoincrement())
  email         String       @unique
  name          String?
  photo         String?
  passwordHash  String?
  block         String?
  flatNo        String?
  role          Role         @default(TENANT)
  createdAt     DateTime     @default(now())
  issues        Issue[]
  maintenance   Maintenance[]
  notices       Notice[]
  staff         Staff?
}

model Notice {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
}

model Issue {
  id          Int      @id @default(autoincrement())
  description String
  status      String   @default("OPEN")
  resolution  String?
  createdAt   DateTime @default(now())
  resolvedAt  DateTime?
  user        User?    @relation(fields: [userId], references: [id])
  userId      Int?
  assignedTo  Staff?   @relation("AssignedIssues", fields: [assignedStaffId], references: [id])
  assignedStaffId Int?
  resolvedBy  Staff?   @relation("ResolvedIssues", fields: [resolvedById], references: [id])
  resolvedById Int?
}

model Staff {
  id             Int       @id @default(autoincrement())
  name           String
  role           Role      @default(STAFF)
  isOnDuty       Boolean   @default(false)
  user           User?     @relation(fields: [userId], references: [id])
  userId         Int?      @unique
  issues         Issue[]   @relation("AssignedIssues")
  resolvedIssues Issue[]   @relation("ResolvedIssues")
  createdAt      DateTime  @default(now())
}

model Maintenance {
  id        Int      @id @default(autoincrement())
  amount    Int
  status    String   @default("DUE")
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  createdAt DateTime @default(now())
}
